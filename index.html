<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8" />
<title>타이머</title>
<style>
  :root {
    --primary: #6b8eef;
    --accent: #f99ca9;
    --text-dark: #222f3e;
    --text-light: #797d8c;
    --shadow: 0 2px 8px 0 rgba(0,0,0,0.1);
  }
  body {
    background: transparent;
    min-height: 100vh;
    margin: 0;
    display: flex; flex-direction: column; align-items: center; justify-content: center;
    font-family: "Pretendard", "Apple SD Gothic Neo", Arial, sans-serif;
    padding: 20px;
    box-sizing: border-box;
  }
  .timer-container {
    background: #fff;
    padding: 16px;
    border-radius: 16px;
    box-shadow: var(--shadow);
    display: inline-block;
    min-width: 280px;
    max-width: 400px;
    width: 100%;
    border: 1px solid var(--primary);
    text-align: center;
    position: relative;
    box-sizing: border-box;
  }
  
  /* 상단 버튼들 */
  .top-controls {
    position: absolute;
    top: 8px;
    right: 8px;
    display: flex;
    gap: 6px;
  }
  
  .top-btn {
    width: 28px;
    height: 28px;
    border: none;
    background: transparent;
    color: var(--primary);
    border-radius: 50%;
    cursor: pointer;
    font-size: 14px;
    display: flex;
    align-items: center;
    justify-content: center;
    transition: all 0.2s;
  }
  .top-btn:hover {
    transform: scale(1.1);
    background: var(--primary);
    color: #fff;
  }
  
  /* 설정 패널 */
  .settings-panel {
    position: absolute;
    top: 40px;
    right: 8px;
    background: #fff;
    border: 1px solid var(--primary);
    border-radius: 12px;
    padding: 16px;
    box-shadow: var(--shadow);
    display: none;
    z-index: 10;
    min-width: 200px;
  }
  .settings-panel.active {
    display: block;
  }
  .settings-section {
    margin-bottom: 12px;
  }
  .settings-section:last-child {
    margin-bottom: 0;
  }
  .settings-section h4 {
    margin: 0 0 6px 0;
    color: var(--text-dark);
    font-size: 12px;
  }
  
  /* 모드 선택 */
  .mode-options {
    display: flex;
    gap: 4px;
    margin-bottom: 8px;
  }
  .mode-option {
    padding: 4px 8px;
    border: 1px solid var(--primary);
    background: transparent;
    color: var(--text-light);
    border-radius: 6px;
    cursor: pointer;
    font-size: 10px;
    transition: all 0.2s;
  }
  .mode-option.active {
    background: var(--primary);
    color: #fff;
    border-color: var(--primary);
  }
  
  /* 색상 설정 */
  .color-section {
    margin-bottom: 8px;
  }
  .color-section:last-child {
    margin-bottom: 0;
  }
  .color-section label {
    display: block;
    font-size: 11px;
    color: var(--text-light);
    margin-bottom: 4px;
  }
  .color-row {
    display: flex;
    gap: 4px;
    align-items: center;
    margin-bottom: 4px;
  }
  .color-option {
    width: 20px;
    height: 20px;
    border-radius: 50%;
    border: 2px solid #fff;
    cursor: pointer;
    transition: transform 0.2s;
    box-shadow: 0 1px 3px rgba(0,0,0,0.2);
  }
  .color-option:hover {
    transform: scale(1.1);
  }
  .color-option.active {
    border: 2px solid var(--text-dark);
    transform: scale(1.1);
  }
  .color-picker {
    width: 20px;
    height: 20px;
    border: none;
    border-radius: 50%;
    cursor: pointer;
    padding: 0;
  }
  .color-picker::-webkit-color-swatch-wrapper {
    padding: 0;
    border-radius: 50%;
  }
  .color-picker::-webkit-color-swatch {
    border: 2px solid #fff;
    border-radius: 50%;
    box-shadow: 0 1px 3px rgba(0,0,0,0.2);
  }

  /* 입력 섹션 */
  .inputs {
    margin-bottom: 2px;
    min-height: 44px; /* 고정 높이로 모든 모드에서 동일한 크기 유지 */
  }
  .inputs.hidden {
    display: none;
  }
  #pomodoroInputs, #timerInputs {
    display: block;
  }
  #pomodoroInputs.hidden, #timerInputs.hidden {
    display: none;
  }
  
  /* 뽀모도로 입력 레이아웃 - 반응형 */
  .pomodoro-inputs-wrapper {
    display: flex;
    flex-wrap: nowrap;
    gap: 4px;
    justify-content: center;
    align-items: center;
    font-size: 12px;
    color: var(--text-light);
  }
  
  label {
    font-size: 11px;
    color: var(--text-light);
    display: flex;
    align-items: center;
    gap: 3px;
  }
  input[type="number"] {
    padding: 2px;
    width: 30px;
    height: 18px;
    font-size: 11px;
    border: 1px solid var(--primary);
    border-radius: 3px;
    text-align: center;
    outline: none;
    color: var(--primary);
    background: #fff;
    -moz-appearance: textfield;
  }
  input[type="number"]::-webkit-outer-spin-button,
  input[type="number"]::-webkit-inner-spin-button {
    -webkit-appearance: none;
    margin: 0;
  }
  input[type="number"]:focus {
    border-color: var(--accent);
  }
  
  /* 타이머 표시 */
  #timer {
    font-size: clamp(32px, 7vw, 48px);
    color: var(--primary);
    margin: 0px 0 8px 0;
    font-weight: 700;
    letter-spacing: 2px;
  }
  
  /* 버튼 그룹 */
  .btn-group {
    margin-top: 12px;
    display: flex; justify-content: center; gap: 8px;
  }
  button.control-btn {
    font-size: 12px;
    padding: 6px 10px;
    background: var(--primary);
    color: #fff;
    border: none;
    border-radius: 6px;
    margin: 0;
    cursor: pointer;
    transition: all .2s;
    min-width: 50px;
    font-weight: 500;
  }
  button.control-btn:hover:not(:disabled) {
    background: var(--accent);
    transform: translateY(-1px);
  }
  button.control-btn:disabled {
    background: var(--primary);
    color: #fff;
    opacity: 0.5;
    cursor: not-allowed;
    transform: none;
  }
  button.control-btn:disabled:hover {
    background: var(--primary);
    opacity: 0.5;
  }
  #pauseBtn.paused {
    background: var(--accent);
  }
  #pauseBtn.paused:hover:not(:disabled) {
    background: var(--primary);
  }
  
  /* 플래시 효과 */
  .flash {
    animation: flash 0.4s linear 0s 1;
  }
  @keyframes flash {
    0%   { background: #fff; }
    30%  { background: var(--accent); }
    50%  { background: var(--primary); }
    80%  { background: var(--accent); }
    100% { background: #fff; }
  }

  /* 반응형 디자인 */
  @media (max-width: 480px) {
    body {
      padding: 10px;
    }
    .timer-container {
      min-width: 250px;
      padding: 12px;
    }
    #timer {
      font-size: clamp(28px, 8vw, 40px);
      margin: 0px 0 6px 0;
    }
    .btn-group {
      gap: 6px;
      margin-top: 10px;
    }
    button.control-btn {
      font-size: 11px;
      padding: 5px 8px;
      min-width: 45px;
    }
    .settings-panel {
      min-width: 160px;
      padding: 12px;
    }
    .inputs {
      margin-bottom: 0px;
    }
    
    /* 뽀모도로 입력을 한 줄로 유지 */
    .pomodoro-inputs-wrapper {
      flex-direction: row;
      justify-content: center;
      gap: 3px;
      width: 100%;
      font-size: 11px;
    }
    
    .timer-container {
      padding-top: 20px; /* 상단 여백 추가 */
    }
  }

  @media (max-width: 320px) {
    .timer-container {
      min-width: 220px;
      padding: 10px;
      padding-top: 24px;
    }
    label {
      font-size: 10px;
    }
    input[type="number"] {
      width: 28px;
      height: 16px;
      font-size: 10px;
    }
    .pomodoro-inputs-wrapper {
      flex-direction: row;
      justify-content: center;
      gap: 2px;
      width: 100%;
      font-size: 10px;
    }
  }
</style>
</head>
<body>
<div class="timer-container" id="mainContainer">
  
  <!-- 상단 컨트롤 버튼들 -->
  <div class="top-controls">
    <button class="top-btn" id="settingsBtn" title="설정">⚙️</button>
  </div>
  
  <!-- 설정 패널 -->
  <div class="settings-panel" id="settingsPanel">
    <div class="settings-section">
      <h4>모드 선택</h4>
      <div class="mode-options">
        <button class="mode-option active" data-mode="0">뽀모도로</button>
        <button class="mode-option" data-mode="1">타이머</button>
        <button class="mode-option" data-mode="2">스톱워치</button>
      </div>
    </div>
    
    <div class="settings-section">
      <h4>테마 색상</h4>
      
      <div class="color-section">
        <label>메인 색상</label>
        <div class="color-row">
          <div class="color-option active" data-color="#6b8eef" data-type="primary" style="background: #6b8eef;"></div>
          <div class="color-option" data-color="#ff6b6b" data-type="primary" style="background: #ff6b6b;"></div>
          <div class="color-option" data-color="#4ecdc4" data-type="primary" style="background: #4ecdc4;"></div>
          <div class="color-option" data-color="#96ceb4" data-type="primary" style="background: #96ceb4;"></div>
          <div class="color-option" data-color="#9b59b6" data-type="primary" style="background: #9b59b6;"></div>
          <div class="color-option" data-color="#f39c12" data-type="primary" style="background: #f39c12;"></div>
          <input type="color" class="color-picker" id="primaryPicker" value="#6b8eef">
        </div>
      </div>
      
      <div class="color-section">
        <label>강조 색상</label>
        <div class="color-row">
          <div class="color-option active" data-color="#f99ca9" data-type="accent" style="background: #f99ca9;"></div>
          <div class="color-option" data-color="#4ecdc4" data-type="accent" style="background: #4ecdc4;"></div>
          <div class="color-option" data-color="#45b7d1" data-type="accent" style="background: #45b7d1;"></div>
          <div class="color-option" data-color="#feca57" data-type="accent" style="background: #feca57;"></div>
          <div class="color-option" data-color="#e74c3c" data-type="accent" style="background: #e74c3c;"></div>
          <div class="color-option" data-color="#95a5a6" data-type="accent" style="background: #95a5a6;"></div>
          <input type="color" class="color-picker" id="accentPicker" value="#f99ca9">
        </div>
      </div>
    </div>
  </div>

  <div class="inputs" id="inputSection">
    <div id="pomodoroInputs">
      <div class="pomodoro-inputs-wrapper">
        <input type="number" id="workInput" value="25" min="1" max="180">분 / 
        <input type="number" id="breakInput" value="5" min="1" max="60">분 / 
        <input type="number" id="cyclesInput" value="4" min="1" max="20">회
      </div>
    </div>
    <div id="timerInputs" class="hidden">
      <div style="display: flex; justify-content: center; align-items: center;">
        <label>
          <input type="number" id="timerMinutes" value="10" min="1" max="999">분
        </label>
      </div>
    </div>
  </div>

  <div id="timer">25:00</div>

  <div class="btn-group">
    <button class="control-btn" id="startBtn">START</button>
    <button class="control-btn" id="pauseBtn" disabled>PAUSE</button>
    <button class="control-btn" id="stopBtn" disabled>RESET</button>
  </div>

</div>
<audio id="alarmSound" src="https://actions.google.com/sounds/v1/alarms/alarm_clock.ogg" preload="auto"></audio>
<script>
  let workMinutes, breakMinutes, cycles;
  let currentCycle = 0;
  let isWork = true;
  let timer, totalSeconds, running = false, paused = false;
  
  // 모드 관리
  let currentMode = 0; // 0: 뽀모도로, 1: 타이머, 2: 스톱워치

  const statusEl = document.getElementById('status');
  const timerEl = document.getElementById('timer');
  const startBtn = document.getElementById('startBtn');
  const pauseBtn = document.getElementById('pauseBtn');
  const stopBtn = document.getElementById('stopBtn');
  const alarmSound = document.getElementById('alarmSound');
  const mainContainer = document.getElementById('mainContainer');

  const workInput = document.getElementById('workInput');
  const breakInput = document.getElementById('breakInput');
  const cyclesInput = document.getElementById('cyclesInput');
  const inputSection = document.getElementById('inputSection');

  // 설정 관련
  const settingsBtn = document.getElementById('settingsBtn');
  const settingsPanel = document.getElementById('settingsPanel');
  const primaryPicker = document.getElementById('primaryPicker');
  const accentPicker = document.getElementById('accentPicker');
  const modeOptions = document.querySelectorAll('.mode-option');

  // 초기 테마 설정
  function updateTheme(primary, accent) {
    document.documentElement.style.setProperty('--primary', primary);
    document.documentElement.style.setProperty('--accent', accent);
  }

  // 각 모드별 상태 저장
  let modeStates = {
    0: { running: false, paused: false, timer: null, totalSeconds: 0, currentCycle: 0, isWork: true }, // 뽀모도로
    1: { running: false, paused: false, timer: null, totalSeconds: 0 }, // 타이머
    2: { running: false, paused: false, timer: null, totalSeconds: 0 }  // 스톱워치
  };

  // 모드 변경
  modeOptions.forEach(option => {
    option.addEventListener('click', () => {
      // 현재 모드 상태 저장
      saveCurrentModeState();
      
      modeOptions.forEach(opt => opt.classList.remove('active'));
      option.classList.add('active');
      currentMode = parseInt(option.dataset.mode);
      
      // 새 모드 상태 복원
      restoreModeState();
      updateMode();
    });
  });

  // 현재 모드 상태 저장
  function saveCurrentModeState() {
    const state = modeStates[currentMode];
    state.running = running;
    state.paused = paused;
    state.timer = timer;
    state.totalSeconds = totalSeconds;
    
    if (currentMode === 0) { // 뽀모도로
      state.currentCycle = currentCycle;
      state.isWork = isWork;
    }
  }

  // 모드 상태 복원
  function restoreModeState() {
    const state = modeStates[currentMode];
    running = state.running;
    paused = state.paused;
    timer = state.timer;
    totalSeconds = state.totalSeconds;
    
    if (currentMode === 0) { // 뽀모도로
      currentCycle = state.currentCycle;
      isWork = state.isWork;
    }
    
    // UI 상태 업데이트
    updateButtonStates();
    if (running) {
      updateTimer();
    }
  }

  // 버튼 상태 업데이트
  function updateButtonStates() {
    startBtn.disabled = running;
    pauseBtn.disabled = !running;
    stopBtn.disabled = !running;
    
    if (running && paused) {
      pauseBtn.textContent = 'RESUME';
      pauseBtn.classList.add('paused');
    } else {
      pauseBtn.textContent = 'PAUSE';
      pauseBtn.classList.remove('paused');
    }
  }

  function updateMode() {
    const pomodoroInputs = document.getElementById('pomodoroInputs');
    const timerInputs = document.getElementById('timerInputs');
    
    // 모든 입력 섹션 숨기기
    pomodoroInputs.classList.add('hidden');
    timerInputs.classList.add('hidden');
    
    switch(currentMode) {
      case 0: // 뽀모도로
        pomodoroInputs.classList.remove('hidden');
        if (!running) {
          timerEl.textContent = `${workInput.value.toString().padStart(2,'0')}:00`;
        }
        break;
      case 1: // 타이머
        timerInputs.classList.remove('hidden');
        if (!running) {
          const timerMinutes = parseInt(document.getElementById('timerMinutes').value, 10) || 10;
          timerEl.textContent = `${timerMinutes.toString().padStart(2,'0')}:00`;
        }
        break;
      case 2: // 스톱워치
        // 스톱워치는 입력 영역이 없으므로 빈 공간으로 동일한 높이 유지
        inputSection.style.minHeight = '44px';
        if (!running) {
          timerEl.textContent = '00:00';
        }
        break;
    }
  }

  // 설정 패널 토글
  settingsBtn.addEventListener('click', (e) => {
    e.stopPropagation();
    settingsPanel.classList.toggle('active');
  });

  // 패널 외부 클릭시 닫기
  document.addEventListener('click', (e) => {
    if (!settingsPanel.contains(e.target) && e.target !== settingsBtn) {
      settingsPanel.classList.remove('active');
    }
  });

  // 색상 옵션 선택
  const colorOptions = document.querySelectorAll('.color-option');
  colorOptions.forEach(option => {
    option.addEventListener('click', () => {
      const color = option.dataset.color;
      const type = option.dataset.type;
      
      document.querySelectorAll(`[data-type="${type}"]`).forEach(opt => opt.classList.remove('active'));
      option.classList.add('active');
      
      document.documentElement.style.setProperty(`--${type}`, color);
      
      if (type === 'primary') {
        primaryPicker.value = color;
      } else {
        accentPicker.value = color;
      }
    });
  });

  // 커스텀 색상 선택
  primaryPicker.addEventListener('change', (e) => {
    const color = e.target.value;
    document.documentElement.style.setProperty('--primary', color);
    document.querySelectorAll('[data-type="primary"]').forEach(opt => opt.classList.remove('active'));
  });

  accentPicker.addEventListener('change', (e) => {
    const color = e.target.value;
    document.documentElement.style.setProperty('--accent', color);
    document.querySelectorAll('[data-type="accent"]').forEach(opt => opt.classList.remove('active'));
  });

  function updateTimer() {
    const minutes = Math.floor(totalSeconds / 60);
    const seconds = totalSeconds % 60;
    timerEl.textContent = `${minutes.toString().padStart(2,'0')}:${seconds.toString().padStart(2,'0')}`;
  }

  function flashScreen(times=3) {
    let count = 0;
    const flashFn = () => {
      mainContainer.classList.add('flash');
      setTimeout(()=> mainContainer.classList.remove('flash'), 290);
      if (++count < times) setTimeout(flashFn, 400);
    };
    flashFn();
  }

  function startPomodoro() {
    if (currentCycle >= cycles) {
      timerEl.textContent = '🎉 완료! 🎉';
      startBtn.disabled = false;
      pauseBtn.disabled = true;
      stopBtn.disabled = true;
      running = false;
      return;
    }
    if (isWork) {
      totalSeconds = workMinutes * 60;
    } else {
      totalSeconds = breakMinutes * 60;
    }
    updateTimer();
    running = true; paused = false; pauseBtn.disabled = false;
    pauseBtn.textContent = 'PAUSE'; pauseBtn.classList.remove('paused');
    timer = setInterval(() => {
      if (!paused) {
        totalSeconds--;
        updateTimer();
        if (totalSeconds <= 0) {
          clearInterval(timer);
          alarmSound.currentTime = 0;
          alarmSound.play();
          flashScreen(3);
          setTimeout(() => {
            if (!isWork) currentCycle++;
            isWork = !isWork;
            startPomodoro();
          }, 1000);
        }
      }
    }, 1000);
  }

  function startRegularTimer() {
    const minutes = parseInt(document.getElementById('timerMinutes').value, 10);
    if (isNaN(minutes) || minutes <= 0) {
      alert('올바른 시간을 입력해주세요.');
      startBtn.disabled = false;
      pauseBtn.disabled = true;
      stopBtn.disabled = true;
      return;
    }
    
    totalSeconds = minutes * 60;
    updateTimer();
    running = true; paused = false; pauseBtn.disabled = false;
    pauseBtn.textContent = 'PAUSE'; pauseBtn.classList.remove('paused');
    
    timer = setInterval(() => {
      if (!paused) {
        totalSeconds--;
        updateTimer();
        if (totalSeconds <= 0) {
          clearInterval(timer);
          alarmSound.currentTime = 0;
          alarmSound.play();
          flashScreen(3);
          timerEl.textContent = '⏰ 완료!';
          running = false;
          startBtn.disabled = false;
          pauseBtn.disabled = true;
          stopBtn.disabled = true;
        }
      }
    }, 1000);
  }

  function startStopwatch() {
    totalSeconds = 0;
    updateTimer();
    running = true; paused = false; pauseBtn.disabled = false;
    pauseBtn.textContent = 'PAUSE'; pauseBtn.classList.remove('paused');
    
    timer = setInterval(() => {
      if (!paused) {
        totalSeconds++;
        updateTimer();
      }
    }, 1000);
  }

  function stopTimer() {
    clearInterval(timer);
    
    // 현재 모드 상태 초기화
    const state = modeStates[currentMode];
    state.running = false;
    state.paused = false;
    state.timer = null;
    state.totalSeconds = 0;
    
    running = false;
    paused = false;
    alarmSound.pause();
    alarmSound.currentTime = 0;
    
    if (currentMode === 0) { // 뽀모도로
      state.currentCycle = 0;
      state.isWork = true;
      currentCycle = 0;
      isWork = true;
    }
    
    switch(currentMode) {
      case 0: // 뽀모도로
        timerEl.textContent = `${workInput.value.toString().padStart(2,'0')}:00`;
        break;
      case 1: // 타이머
        const timerMinutes = parseInt(document.getElementById('timerMinutes').value, 10) || 10;
        timerEl.textContent = `${timerMinutes.toString().padStart(2,'0')}:00`;
        break;
      case 2: // 스톱워치
        timerEl.textContent = '00:00';
        break;
    }
    
    startBtn.disabled = false;
    pauseBtn.disabled = true; pauseBtn.textContent = 'PAUSE'; pauseBtn.classList.remove('paused');
    stopBtn.disabled = true;
  }

  function pauseTimer() {
    if (running && !paused) {
      paused = true;
      pauseBtn.textContent = 'RESUME';
      pauseBtn.classList.add('paused');
    } else if (running && paused) {
      paused = false;
      pauseBtn.textContent = 'PAUSE';
      pauseBtn.classList.remove('paused');
    }
  }

  startBtn.addEventListener('click', () => {
    // 현재 모드 상태 업데이트
    const state = modeStates[currentMode];
    state.running = true;
    state.paused = false;
    
    startBtn.disabled = true;
    pauseBtn.disabled = false;
    stopBtn.disabled = false;
    
    switch(currentMode) {
      case 0: // 뽀모도로
        workMinutes = parseInt(workInput.value, 10);
        breakMinutes = parseInt(breakInput.value, 10);
        cycles = parseInt(cyclesInput.value, 10);
        if (isNaN(workMinutes) || workMinutes <= 0 || isNaN(breakMinutes) || breakMinutes <= 0 || isNaN(cycles) || cycles <= 0) {
          alert('모든 입력값은 양의 정수여야 합니다.');
          state.running = false;
          startBtn.disabled = false;
          pauseBtn.disabled = true;
          stopBtn.disabled = true;
          return;
        }
        currentCycle = 0;
        isWork = true;
        state.currentCycle = 0;
        state.isWork = true;
        startPomodoro();
        break;
      case 1: // 타이머
        startRegularTimer();
        break;
      case 2: // 스톱워치
        startStopwatch();
        break;
    }
    
    // 타이머 참조를 상태에 저장
    state.timer = timer;
  });

  stopBtn.addEventListener('click', stopTimer);
  pauseBtn.addEventListener('click', pauseTimer);

  // 초기 모드 설정
  updateMode();
</script>
</body>
</html>
